<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blog Details | Jain Events and Caterers</title>

    <!-- Canonical URL -->
    <link rel="canonical" href="" id="canonical-url" />

    <!-- Favicon -->
    <link rel="icon" type="image/jpg" href="../img/logo.jpg" />

    <!-- Tailwind & Fonts -->
    <link href="../src/css/output.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        .font-poppins {
            font-family: 'Poppins', sans-serif;
        }
    </style>

    <!-- AUTO CANONICAL (FINAL) -->
    <script>
        (function () {
            const path = window.location.pathname;

            // Expected URL: /blog/slug-name
            if (path.startsWith("/blog/") && path.split("/").length > 2) {
                const slug = path.split("/")[2];
                document.getElementById("canonical-url").setAttribute(
                    "href",
                    `https://jain-events-and-caterers.netlify.app/blog/${slug}`
                );
            } else {
                document.getElementById("canonical-url").setAttribute(
                    "href",
                    "https://jain-events-and-caterers.netlify.app/blog"
                );
            }
        })();
    </script>
</head>

<body class="bg-white text-black font-poppins">

    <!-- Navbar -->
    <div id="navbar-container"></div>

    <!-- Padding for fixed navbar -->
    <div class="h-20 md:h-24"></div>

    <!-- Blog Details Section -->
    <section class="bg-white py-16 px-6 md:px-12">
        <div class="max-w-4xl mx-auto">

            <!-- Loader -->
            <div id="loader" class="text-center py-20 text-gray-600">
                <svg class="animate-spin h-10 w-10 text-[#F8153E] mx-auto mb-4" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
                </svg>
                <p class="font-medium">Loading blog details...</p>
            </div>

            <!-- Blog Content -->
            <article id="blogContent" class="hidden bg-white border border-gray-200 rounded-2xl shadow-lg p-6 md:p-10">

                <h1 id="blogTitle" class="text-3xl md:text-4xl font-bold text-[#F8153E] mb-4"></h1>

                <p id="blogMeta" class="text-gray-500 text-sm mb-6"></p>

                <div id="blogBody" class="text-gray-800 leading-relaxed whitespace-pre-line text-lg"></div>

                <div class="mt-10 text-center">
                    <a href="/blog" class="text-[#F8153E] hover:underline font-semibold">‚Üê Back to Blogs</a>
                </div>
            </article>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden text-center text-red-600 font-medium mt-10">
                Blog not found.
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="text-center p-4 text-sm text-white bg-[#F8153E]">
        ¬© 2025 Jain Events and Caterers. All rights reserved.
    </footer>

    <!-- BLOG LOGIC -->
    <script>
        document.addEventListener("DOMContentLoaded", async () => {

            const loader = document.getElementById("loader");
            const blogContent = document.getElementById("blogContent");
            const blogTitle = document.getElementById("blogTitle");
            const blogMeta = document.getElementById("blogMeta");
            const blogBody = document.getElementById("blogBody");
            const errorMessage = document.getElementById("errorMessage");

            // Extract slug from /blog/slug
            const pathParts = window.location.pathname.split("/");
            const slug = pathParts[2];

            if (!slug) {
                loader.classList.add("hidden");
                errorMessage.classList.remove("hidden");
                return;
            }

            // Linkify URLs
            function linkify(text) {
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                return text.replace(urlRegex, (url) => {
                    let label = "Visit Link";
                    if (url.includes("wa.me")) label = "Chat on WhatsApp üí¨";
                    else if (url.includes("facebook.com")) label = "Visit our Facebook Page";
                    else if (url.includes("instagram.com")) label = "Check on Instagram üì∏";
                    else if (url.includes("youtube.com")) label = "Watch on YouTube ‚ñ∂Ô∏è";
                    else if (url.includes("netlify.app/services")) label = "Visit Services Page üîó";
                    else if (url.includes("netlify.app")) label = "Visit Jain Events Website üåê";
                    return `<a href="${url}" target="_blank"
                        class="text-[#F8153E] hover:text-[#c40f32] font-semibold underline">${label}</a>`;
                });
            }

            function formatText(text) {
                text = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                text = text.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
                text = text.replace(/\*(.*?)\*/g, "<em>$1</em>");
                text = text.replace(/__(.*?)__/g, "<u>$1</u>");
                text = text.replace(/\n/g, "<br>");
                return text;
            }

            try {
                const res = await fetch(
                    `https://backend-jaine-cforrender.onrender.com/blogs/slug/${slug}`
                );
                if (!res.ok) throw new Error("Blog not found");

                const blog = await res.json();

                blogTitle.textContent = blog.title;
                blogMeta.textContent = `Category: ${blog.category || "General"} ‚Ä¢ ${blog.createdAt || ""}`;
                blogBody.innerHTML = linkify(formatText(blog.content || ""));

                // Dynamic SEO
                document.title = `${blog.title} | Jain Events & Caterers`;

                let metaDesc = document.querySelector('meta[name="description"]');
                if (!metaDesc) {
                    metaDesc = document.createElement("meta");
                    metaDesc.setAttribute("name", "description");
                    document.head.appendChild(metaDesc);
                }
                metaDesc.setAttribute(
                    "content",
                    blog.content.replace(/[#*_]/g, "").slice(0, 150) + "..."
                );

                loader.classList.add("hidden");
                blogContent.classList.remove("hidden");

            } catch (err) {
                console.error(err);
                loader.classList.add("hidden");
                errorMessage.classList.remove("hidden");
            }
        });
    </script>

    <script src="../js/include.js"></script>
</body>

</html>