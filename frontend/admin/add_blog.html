<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Blog | Jain Events and Caterers</title>

    <!-- SEO Protection for Admin -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">

    <link rel="icon" type="image/jpg" href="/img/logo.jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --brand-color: #F8153E;
        }

        .btn-primary {
            background-color: var(--brand-color);
            color: white;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background-color: #d21235;
        }

        .brand-text {
            color: var(--brand-color);
        }

        .brand-border {
            border-color: var(--brand-color);
        }

        .brand-focus:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(248, 21, 62, 0.4);
            border-color: var(--brand-color);
        }

        /* Custom breakpoint for 650px */
        @media (min-width: 650px) {
            .desktop-menu {
                display: flex !important;
            }

            .mobile-menu,
            .hamburger {
                display: none !important;
            }
        }

        @media (max-width: 649px) {
            .desktop-menu {
                display: none !important;
            }

            .hamburger {
                display: block !important;
            }

            .mobile-menu a {
                text-align: center;
            }
        }
    </style>
</head>

<body class="bg-gray-50 font-sans">

    <!-- Navbar -->
    <nav class="bg-[var(--brand-color)] p-4 shadow-md">
        <div class="flex justify-between items-center">
            <a href="index.html" id="nav-logo" class="flex items-center gap-2 min-w-0 max-w-[75%]">
                <img src="/img/logo.jpg" alt="Logo"
                    class="h-8 w-8 sm:h-10 sm:w-10 object-cover rounded-full shrink-0" />
                <span
                    class="text-base sm:text-xl font-semibold text-white whitespace-nowrap overflow-hidden text-ellipsis">
                    Jain Events and Caterers
                </span>
            </a>

            <button id="menu-toggle" class="hamburger text-white focus:outline-none hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>

            <div class="desktop-menu hidden space-x-6">
                <a href="dashboard.html" class="text-white hover:underline">Dashboard</a>
                <a href="blog.html" class="text-white hover:underline">All Blogs</a>
                <a href="add_blog.html" class="text-white font-semibold underline">Add Blog</a>
                <a href="messages.html" class="text-white hover:underline">Messages</a>
            </div>
        </div>

        <div id="mobile-menu" class="mobile-menu hidden mt-4 flex flex-col space-y-3 items-center">
            <a href="dashboard.html" class="text-white hover:underline">Dashboard</a>
            <a href="blog.html" class="text-white hover:underline">All Blogs</a>
            <a href="add_blog.html" class="text-white font-semibold underline">Add Blog</a>
            <a href="messages.html" class="text-white hover:underline">Messages</a>
        </div>
    </nav>

    <!-- Main Form -->
    <main class="max-w-3xl mx-auto bg-white shadow-lg rounded-xl p-8 mt-8">
        <form id="addBlogForm" class="space-y-6">
            <div>
                <label class="block brand-text font-medium mb-2">Blog Title</label>
                <input id="title" type="text" name="title" placeholder="Enter blog title"
                    class="w-full border rounded-lg px-4 py-2 brand-focus">
            </div>

            <div>
                <label class="block brand-text font-medium mb-2">Category</label>
                <select id="category" name="category" class="w-full border rounded-lg px-4 py-2 brand-focus">
                    <option value="">Select category</option>
                    <option value="wedding">Wedding</option>
                    <option value="birthday">Birthday</option>
                    <option value="corporate">Corporate</option>
                    <option value="festival">Festival</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div>
                <label class="block brand-text font-medium mb-2">Content</label>
                <textarea id="content" name="content" rows="6" placeholder="Write your blog content here..."
                    class="w-full border rounded-lg px-4 py-2 brand-focus"></textarea>
            </div>

            <!-- META TITLE -->
            <div>
                <label class="block brand-text font-medium mb-2">Meta Title (Optional)</label>
                <input id="metaTitle" type="text" name="metaTitle" placeholder="SEO title (defaults to blog title)"
                    class="w-full border rounded-lg px-4 py-2 brand-focus">
            </div>

            <!-- META DESCRIPTION -->
            <div>
                <label class="block brand-text font-medium mb-2">Meta Description (Optional)</label>
                <textarea id="metaDescription" name="metaDescription" rows="3"
                    placeholder="Short SEO summary (150-160 characters recommended)"
                    class="w-full border rounded-lg px-4 py-2 brand-focus"></textarea>
                <div class="text-right text-xs text-gray-500 mt-1">
                    <span id="metaCount">0</span>/160
                </div>
            </div>

            <div class="flex justify-end space-x-4">
                <button type="button" onclick="window.location.href='dashboard.html'"
                    class="bg-gray-300 px-6 py-2 rounded-lg hover:bg-gray-400 transition">
                    Cancel
                </button>
                <button id="publishBtn" type="submit" class="btn-primary px-6 py-2 rounded-lg shadow hover:shadow-lg">
                    Publish Blog
                </button>
            </div>
        </form>
    </main>

    <script>
        // update meta character count
        const metaDescriptionEl = document.getElementById("metaDescription");
        const metaCountEl = document.getElementById("metaCount");
        metaDescriptionEl.addEventListener("input", () => {
            metaCountEl.textContent = metaDescriptionEl.value.length;
        });

        document.getElementById("addBlogForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const title = document.getElementById("title").value.trim();
            const category = document.getElementById("category").value;
            const content = document.getElementById("content").value.trim();
            const metaTitle = document.getElementById("metaTitle").value.trim();
            const metaDescription = document.getElementById("metaDescription").value.trim();
            const token = localStorage.getItem("token");

            if (!title || !category || !content) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Please fill all required fields."
                });
                return;
            }

            // Choose backend dynamically (local â†’ production fallback)
            const API_URL = window.location.hostname === "localhost"
                ? "http://localhost:5000/blogs/create-blog"
                : "https://backend-jaine-cforrender.onrender.com/blogs/create-blog";

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        title,
                        category,
                        content,
                        metaTitle: metaTitle || undefined,
                        metaDescription: metaDescription || undefined
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "Blog Published!",
                        text: "Your blog has been successfully posted.",
                        showConfirmButton: false,
                        timer: 1500
                    });
                    setTimeout(() => window.location.href = "/admin/dashboard.html", 1600);
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Failed",
                        text: data.message || "Failed to create blog."
                    });
                }
            } catch (error) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Something went wrong while publishing."
                });
                console.error(error);
            }
        });
    </script>
</body>

</html>